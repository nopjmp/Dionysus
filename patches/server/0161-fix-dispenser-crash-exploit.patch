From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: RemainingToast <Remainingtoast@gmail.com>
Date: Wed, 24 Aug 2022 16:03:38 +1000
Subject: [PATCH] fix dispenser crash exploit


diff --git a/src/main/java/org/bukkit/craftbukkit/block/CraftDispenser.java b/src/main/java/org/bukkit/craftbukkit/block/CraftDispenser.java
index bfcf9b6c4d25cdb5971d02e64316f5aca4722362..32e4ff0eb63d9b71a55df6c4a4b9fb237ed2ee06 100644
--- a/src/main/java/org/bukkit/craftbukkit/block/CraftDispenser.java
+++ b/src/main/java/org/bukkit/craftbukkit/block/CraftDispenser.java
@@ -58,10 +58,12 @@ public class CraftDispenser extends CraftLootable<TileEntityDispenser> implement
             CraftWorld world = (CraftWorld) this.getWorld();
             BlockDispenser dispense = (BlockDispenser) Blocks.DISPENSER;
 
-            dispense.dispense(world.getHandle(), new BlockPosition(getX(), getY(), getZ()));
-            return true;
-        } else {
-            return false;
+            if (!(getY() >= 255.0D || getY() <= 0.0D)) { // Dionysus - fix dispenser crash exploit
+                dispense.dispense(world.getHandle(), new BlockPosition(getX(), getY(), getZ()));
+                return true;
+            }
         }
+
+        return false;
     }
 }
diff --git a/src/main/java/org/bukkit/craftbukkit/block/CraftDropper.java b/src/main/java/org/bukkit/craftbukkit/block/CraftDropper.java
index 27f6e66ec8fa4c09128e9ce0fa47d8b7898c66f8..a749c3f1341a6f1c2e500058e5f879232a54cc72 100644
--- a/src/main/java/org/bukkit/craftbukkit/block/CraftDropper.java
+++ b/src/main/java/org/bukkit/craftbukkit/block/CraftDropper.java
@@ -44,7 +44,9 @@ public class CraftDropper extends CraftLootable<TileEntityDropper> implements Dr
             CraftWorld world = (CraftWorld) this.getWorld();
             BlockDropper drop = (BlockDropper) Blocks.DROPPER;
 
-            drop.dispense(world.getHandle(), new BlockPosition(getX(), getY(), getZ()));
+            if (!(getY() >= 255.0D || getY() <= 0.0D)) { // Dionysus - fix dispenser crash exploit
+                drop.dispense(world.getHandle(), new BlockPosition(getX(), getY(), getZ()));
+            }
         }
     }
 }
